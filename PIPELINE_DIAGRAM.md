# 컬쳐핏 분석 파이프라인 다이어그램

> **작성일**: 2024-12-18
> **버전**: 1.0.0-test

---

## 전체 파이프라인 흐름

```
╔═══════════════════════════════════════════════════════════════════════════════════╗
║                         컬쳐핏 분석 전체 파이프라인                                  ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────┐     ┌───────────────────────────────────┐
│      PIPELINE A: 회사 분석         │     │      PIPELINE B: 구직자 분석        │
└───────────────────────────────────┘     └───────────────────────────────────┘
              │                                         │
              ▼                                         ▼
┌───────────────────────────────────┐     ┌───────────────────────────────────┐
│  INPUT: 채용공고 URL               │     │  INPUT: 이력서/포트폴리오 텍스트    │
│  https://toss.im/career/...       │     │  (텍스트 파일 또는 직접 입력)        │
└───────────────────────────────────┘     └───────────────────────────────────┘
              │                                         │
              ▼                                         │
┌───────────────────────────────────┐                   │
│  STEP A-1: 웹 스크래핑             │                   │
│  ┌─────────────────────────────┐  │                   │
│  │  JinaScraper                │  │                   │
│  │  (Jina Reader API)          │  │                   │
│  └─────────────────────────────┘  │                   │
│  OUTPUT: 스크래핑 텍스트           │                   │
└───────────────────────────────────┘                   │
              │                                         │
              ▼                                         ▼
┌───────────────────────────────────┐     ┌───────────────────────────────────┐
│  STEP A-2: 회사 데이터 수집        │     │  STEP B-1: 구직자 데이터 분석       │
│  ┌─────────────────────────────┐  │     │  ┌─────────────────────────────┐  │
│  │  company_data_collect.py    │  │     │  │  applicant_analyze.py       │  │
│  │  + company_schema.json      │  │     │  │  + applicant_schema.json    │  │
│  │  + Gemini LLM               │  │     │  │  + Gemini LLM               │  │
│  └─────────────────────────────┘  │     │  └─────────────────────────────┘  │
│  OUTPUT: company_data (JSON)      │     │  OUTPUT: applicant_profile (JSON) │
└───────────────────────────────────┘     └───────────────────────────────────┘
              │                                         │
              ▼                                         │
┌───────────────────────────────────┐                   │
│  STEP A-3: 회사 컬쳐핏 분석        │                   │
│  ┌─────────────────────────────┐  │                   │
│  │  company_culture_analyze.py │  │                   │
│  │  + company_schema.json      │  │                   │
│  │  + Gemini LLM               │  │                   │
│  └─────────────────────────────┘  │                   │
│  OUTPUT: company_culture (JSON)   │                   │
└───────────────────────────────────┘                   │
              │                                         │
              ▼                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  PIPELINE C: 컬쳐핏 비교 분석                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────┐              ┌─────────────────────┐                  │
│  │  company_culture    │              │  applicant_profile  │                  │
│  │  (회사 컬쳐핏 JSON)  │              │  (구직자 프로필 JSON) │                  │
│  └──────────┬──────────┘              └──────────┬──────────┘                  │
│             │                                    │                              │
│             └──────────────┬─────────────────────┘                              │
│                            ▼                                                    │
│             ┌───────────────────────────────────┐                               │
│             │  STEP C-1: 컬쳐핏 비교 분석        │                               │
│             │  ┌─────────────────────────────┐  │                               │
│             │  │  culture_compare.py         │  │                               │
│             │  │  + Gemini LLM               │  │                               │
│             │  └─────────────────────────────┘  │                               │
│             └───────────────────────────────────┘                               │
│                            │                                                    │
│                            ▼                                                    │
│             ┌───────────────────────────────────┐                               │
│             │  OUTPUT: 매칭 결과 JSON            │                               │
│             │  {                                │                               │
│             │    "match_score": 85,             │                               │
│             │    "fit_analysis": {...},         │                               │
│             │    "recommendation": "..."        │                               │
│             │  }                                │                               │
│             └───────────────────────────────────┘                               │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 프롬프트 & 스키마 파일 매핑

| 파이프라인 | 프롬프트 파일 | 스키마 파일 | 역할 |
|-----------|-------------|------------|------|
| **A. 회사** | `company_data_collect.py` | `company_schema.json` | 스크래핑 텍스트 → 회사 데이터 추출 |
| **A. 회사** | `company_culture_analyze.py` | `company_schema.json` | 회사 데이터 → 컬쳐핏 점수 분석 |
| **B. 구직자** | `applicant_analyze.py` | `applicant_schema.json` | 이력서 → 구직자 프로필 분석 |
| **C. 비교** | `culture_compare.py` | - | 회사+구직자 → 매칭 점수 |

---

## 파일 구조

```
langchain_pipeline/
├── chains/
│   ├── company_chain.py      # Pipeline A 오케스트레이터
│   ├── applicant_chain.py    # Pipeline B 오케스트레이터
│   └── compare_chain.py      # Pipeline C 오케스트레이터
│
├── scrapers/
│   ├── base_scraper.py       # 추상 베이스 클래스
│   ├── jina_scraper.py       # Jina Reader 기반 (현재 사용)
│   ├── gemini_scraper.py     # Gemini 직접 접근 (백업)
│   └── browser_scraper.py    # Playwright (추후 확장)
│
├── prompts/
│   ├── company_data_collect.py     # A-2: 회사 데이터 수집
│   ├── company_culture_analyze.py  # A-3: 회사 컬쳐핏 분석
│   ├── applicant_analyze.py        # B-1: 구직자 분석
│   └── culture_compare.py          # C-1: 컬쳐핏 비교
│
├── schemas/
│   ├── company_schema.json         # 회사 분석 출력 스키마
│   └── applicant_schema.json       # 구직자 분석 출력 스키마
│
└── utils/
    ├── schema_loader.py      # JSON 스키마 동적 로딩
    └── db_handler.py         # MongoDB 핸들러
```

---

## 구현 상태

### ✅ 구현 완료 (E2E 테스트 검증됨)

| 구성요소 | 파일 | 비고 |
|---------|------|------|
| 웹 스크래퍼 | `jina_scraper.py` | Jina Reader API 사용 |
| 회사 데이터 수집 | `company_data_collect.py` | 테스트용 임시 프롬프트 |
| 회사 컬쳐핏 분석 | `company_culture_analyze.py` | 테스트용 임시 프롬프트 |
| 회사 스키마 | `company_schema.json` | 테스트용 스키마 |
| E2E 테스트 | `test_company_pipeline.py` | CLI 테스트 스크립트 |

### ⏳ 플레이스홀더 (AI 팀원 작성 필요)

| 구성요소 | 파일 | 비고 |
|---------|------|------|
| 구직자 분석 | `applicant_analyze.py` | 이력서 → 프로필 JSON |
| 컬쳐핏 비교 | `culture_compare.py` | 회사+구직자 → 매칭 |

### 📁 기존 스키마 (활용 가능)

| 파일 | 원본 | 비고 |
|------|------|------|
| `applicant_schema.json` | `developer_profile_fixed_schema_key01.json` | 구직자 프로필 스키마 |

---

## 테스트 결과 예시 (토스 채용공고)

### 입력
```
URL: https://toss.im/career/job-detail?job_id=4664498003...
```

### 출력 (컬쳐핏 점수)

| 항목 | 점수 | 요약 |
|------|:----:|------|
| tech_culture | 3/4 | Tech Talk, 코드리뷰, TypeScript |
| collaboration_style | 3/4 | 사일로/매트릭스, 자율성 |
| growth_environment | 3/4 | Committee 운영, 기술 공유 |
| work_life_balance | 1/4 | 명시적 정보 부족 |
| ownership_expectation | 3/4 | 주도적 문제 해결 강조 |

### 전체 요약
> 토스는 기술 공유와 성장을 장려하며, 개발자에게 높은 수준의 자율성과 오너십을 기대하는 문화를 가지고 있습니다.

---

## 사용법

### 회사 컬쳐핏 분석 테스트
```bash
python scripts/test_company_pipeline.py "채용공고URL" --output result.json
```

### 옵션
- `--verbose` / `-v`: 상세 출력
- `--output` / `-o`: 결과 JSON 파일 저장 경로
